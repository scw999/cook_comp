<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ë©” ì›Œì¦ˆ: ë¯¸ì‹ì˜ ê³„ë‹¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-title {
            text-align: center;
            padding: 60px 20px;
        }

        .main-title h1 {
            font-size: 3.5em;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            margin-bottom: 10px;
        }

        .main-title h2 {
            font-size: 1.5em;
            color: #aaa;
            font-weight: normal;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid #ffd700;
        }

        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .player-setup {
            text-align: center;
            padding: 40px;
        }

        .player-count-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .player-count-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            font-size: 2em;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #ffd700;
            color: #ffd700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-count-btn:hover, .player-count-btn.selected {
            background: #ffd700;
            color: #1a1a2e;
        }

        .player-names {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .player-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .player-input input {
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #ffd700;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            width: 200px;
        }

        .player-input label {
            color: #ffd700;
            font-weight: bold;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .round-info {
            font-size: 1.3em;
        }

        .current-player {
            color: #ffd700;
            font-size: 1.5em;
            font-weight: bold;
        }

        .timer {
            font-size: 2em;
            color: #ff6b6b;
            font-weight: bold;
        }

        .phase-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .phase {
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            font-size: 0.9em;
        }

        .phase.active {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: #1a1a2e;
            font-weight: bold;
        }

        .phase.completed {
            background: #4caf50;
            color: #fff;
        }

        .ingredient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .ingredient-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .ingredient-card:hover {
            transform: translateY(-5px);
            border-color: #ffd700;
        }

        .ingredient-card.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
        }

        .ingredient-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .ingredient-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .ingredient-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .ingredient-stats {
            font-size: 0.75em;
            color: #aaa;
        }

        .synergy-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .synergy-score {
            font-size: 2.5em;
            font-weight: bold;
        }

        .synergy-positive { color: #4caf50; }
        .synergy-negative { color: #ff6b6b; }
        .synergy-neutral { color: #ffd700; }

        .selected-ingredients {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .selected-slot {
            width: 120px;
            height: 150px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed #ffd700;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            color: #aaa;
        }

        .selected-slot.filled {
            border-style: solid;
            background: rgba(255, 215, 0, 0.1);
        }

        .cooking-game {
            text-align: center;
            padding: 40px;
        }

        .cooking-animation {
            font-size: 8em;
            margin: 30px 0;
            animation: cookBounce 0.5s ease infinite alternate;
        }

        @keyframes cookBounce {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .gauge-container {
            width: 100%;
            max-width: 600px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            margin: 30px auto;
            position: relative;
            overflow: hidden;
        }

        .gauge-target {
            position: absolute;
            height: 100%;
            background: rgba(76, 175, 80, 0.5);
            border-radius: 30px;
        }

        .gauge-indicator {
            position: absolute;
            width: 10px;
            height: 100%;
            background: #fff;
            border-radius: 5px;
            transition: left 0.05s linear;
        }

        .cooking-instructions {
            font-size: 1.3em;
            margin: 20px 0;
            color: #ffd700;
        }

        .cooking-score {
            font-size: 2em;
            margin: 20px 0;
        }

        .combo-display {
            font-size: 1.5em;
            color: #ff6b6b;
        }

        .plating-area {
            display: flex;
            gap: 30px;
            margin: 20px 0;
        }

        .plate-canvas {
            flex: 2;
            min-height: 400px;
            background: linear-gradient(145deg, #2a2a4a, #1a1a3a);
            border-radius: 50%;
            border: 5px solid #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .plate-decoration {
            position: absolute;
            font-size: 3em;
            cursor: move;
            user-select: none;
        }

        .theme-selector {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
        }

        .theme-option {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .theme-option:hover {
            border-color: #ffd700;
        }

        .theme-option.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
        }

        .decoration-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .decoration-item {
            font-size: 2em;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .decoration-item:hover {
            transform: scale(1.2);
        }

        .judging-screen {
            text-align: center;
            padding: 40px;
        }

        .judges-panel {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin: 40px 0;
        }

        .judge-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            width: 300px;
        }

        .judge-avatar {
            font-size: 5em;
            margin-bottom: 15px;
        }

        .judge-name {
            font-size: 1.3em;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .judge-score {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-breakdown {
            text-align: left;
            font-size: 0.9em;
            color: #aaa;
        }

        .score-breakdown div {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .final-score {
            font-size: 4em;
            font-weight: bold;
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 30px 0;
        }

        .boss-intro {
            text-align: center;
            padding: 40px;
        }

        .boss-portrait {
            font-size: 10em;
            margin: 30px 0;
            animation: bossAppear 1s ease;
        }

        @keyframes bossAppear {
            from { transform: scale(0) rotate(-180deg); opacity: 0; }
            to { transform: scale(1) rotate(0); opacity: 1; }
        }

        .boss-name {
            font-size: 2.5em;
            color: #ff6b6b;
            margin-bottom: 10px;
        }

        .boss-title {
            font-size: 1.3em;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .boss-skill {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 500px;
        }

        .boss-skill h4 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }

        .scoreboard {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .scoreboard-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .scoreboard-row:last-child {
            border-bottom: none;
        }

        .scoreboard-row.current {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
        }

        .player-rank {
            font-size: 1.5em;
            width: 50px;
            color: #ffd700;
        }

        .player-info {
            flex: 1;
            margin-left: 20px;
        }

        .player-fame {
            color: #aaa;
            font-size: 0.9em;
        }

        .player-tier {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .tier-underdog { background: #607d8b; }
        .tier-challenger { background: #9c27b0; }
        .tier-artisan { background: #2196f3; }
        .tier-master { background: #ff9800; }
        .tier-royal { background: linear-gradient(45deg, #ffd700, #ff6b6b); }

        .event-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #2a2a4a, #1a1a3a);
            border: 3px solid #ff6b6b;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 1000;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .event-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .event-title {
            font-size: 1.5em;
            color: #ff6b6b;
            margin-bottom: 15px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .victory-screen {
            text-align: center;
            padding: 60px;
        }

        .trophy {
            font-size: 10em;
            animation: trophyShine 2s ease infinite;
        }

        @keyframes trophyShine {
            0%, 100% { filter: drop-shadow(0 0 20px #ffd700); }
            50% { filter: drop-shadow(0 0 40px #ffd700); }
        }

        .winner-name {
            font-size: 3em;
            color: #ffd700;
            margin: 30px 0;
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-tab:hover, .category-tab.active {
            background: #ffd700;
            color: #1a1a2e;
        }

        @media (max-width: 768px) {
            .main-title h1 { font-size: 2em; }
            .judges-panel { flex-direction: column; align-items: center; }
            .plating-area { flex-direction: column; }
            .plate-canvas { min-height: 300px; }
        }

        .shake { animation: shake 0.5s ease; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .pulse { animation: pulse 1s ease infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë©”ì¸ ë©”ë‰´ -->
        <div id="main-menu" class="screen active">
            <div class="main-title">
                <h1>ê³ ë©” ì›Œì¦ˆ</h1>
                <h2>ë¯¸ì‹ì˜ ê³„ë‹¨</h2>
            </div>
            <div class="menu-buttons">
                <button class="btn btn-primary" onclick="showScreen('player-setup')">ìƒˆ ê²Œì„</button>
                <button class="btn btn-secondary" onclick="showScreen('how-to-play')">ê²Œì„ ë°©ë²•</button>
            </div>
        </div>

        <!-- ê²Œì„ ë°©ë²• -->
        <div id="how-to-play" class="screen">
            <h2 style="text-align: center; margin-bottom: 30px; color: #ffd700;">ê²Œì„ ë°©ë²•</h2>
            <div style="max-width: 800px; margin: 0 auto; line-height: 1.8;">
                <h3 style="color: #ff6b6b; margin: 20px 0 10px;">ê²Œì„ ê°œìš”</h3>
                <p>ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ê³¼ ìš”ë¦¬ ëŒ€ê²°ì„ í¼ì³ ìµœê³ ì˜ ë¯¸ì‹ ë§ˆìŠ¤í„°ê°€ ë˜ì„¸ìš”!</p>

                <h3 style="color: #ff6b6b; margin: 20px 0 10px;">ë¼ìš´ë“œë‹¹ 3ë‹¨ê³„ ì§„í–‰</h3>
                <p><strong>1. ì¬ë£Œ ìˆ˜ì§‘:</strong> ì œí•œ ì‹œê°„ ë‚´ì— ì¬ë£Œë¥¼ ì„ íƒí•˜ì„¸ìš”. ì‹œë„ˆì§€ ë³´ë„ˆìŠ¤ë¥¼ ë…¸ë¦¬ì„¸ìš”!</p>
                <p><strong>2. ì¡°ë¦¬í•˜ê¸°:</strong> ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ ì •í™•í•œ íƒ€ì´ë°ì— ì¡°ë¦¬í•˜ì„¸ìš”.</p>
                <p><strong>3. í”Œë ˆì´íŒ…:</strong> í…Œë§ˆë¥¼ ì„ íƒí•˜ê³  ì ‘ì‹œë¥¼ ì¥ì‹í•˜ì—¬ ì¶”ê°€ ì ìˆ˜ë¥¼ ì–»ìœ¼ì„¸ìš”.</p>

                <h3 style="color: #ff6b6b; margin: 20px 0 10px;">ì ìˆ˜ ê³„ì‚°</h3>
                <p>ë‘ ëª…ì˜ ì‹¬ì‚¬ìœ„ì›ì´ ë‹¹ì‹ ì˜ ìš”ë¦¬ë¥¼ í‰ê°€í•©ë‹ˆë‹¤:</p>
                <p><strong>ì‹¬ì‚¬ìœ„ì› A (ëƒ‰ì² í•œ ë¶„ì„ê°€):</strong> ì¡°ë¦¬ ê¸°ìˆ ê³¼ ì¬ë£Œ ê¶í•©ì— ì§‘ì¤‘</p>
                <p><strong>ì‹¬ì‚¬ìœ„ì› B (ê°ì„± ë¯¸ì‹ê°€):</strong> í”Œë ˆì´íŒ…, í…Œë§ˆ, í”„ë ˆì  í…Œì´ì…˜ì„ ì¤‘ì‹œ</p>

                <h3 style="color: #ff6b6b; margin: 20px 0 10px;">ë³´ìŠ¤ì „</h3>
                <p>ì„¸ ëª…ì˜ ì „ì„¤ì ì¸ ì…°í”„ë¥¼ ë¬¼ë¦¬ì¹˜ê³  ë¯¸ì‹ ë§ˆìŠ¤í„°ì˜ ì¹­í˜¸ë¥¼ íšë“í•˜ì„¸ìš”!</p>
            </div>
            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-secondary" onclick="showScreen('main-menu')">ëŒì•„ê°€ê¸°</button>
            </div>
        </div>

        <!-- í”Œë ˆì´ì–´ ì„¤ì • -->
        <div id="player-setup" class="screen">
            <div class="player-setup">
                <h2 style="color: #ffd700; margin-bottom: 20px;">í”Œë ˆì´ì–´ ì„ íƒ</h2>
                <div class="player-count-selector">
                    <button class="player-count-btn" onclick="setPlayerCount(2)">2</button>
                    <button class="player-count-btn" onclick="setPlayerCount(3)">3</button>
                    <button class="player-count-btn" onclick="setPlayerCount(4)">4</button>
                </div>
                <div id="player-names" class="player-names"></div>
                <button class="btn btn-primary" onclick="startGame()" style="margin-top: 30px;">ê²Œì„ ì‹œì‘</button>
                <button class="btn btn-secondary" onclick="showScreen('main-menu')" style="margin-top: 15px;">ëŒì•„ê°€ê¸°</button>
            </div>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="round-info">ë¼ìš´ë“œ <span id="current-round">1</span> / <span id="total-rounds">4</span></div>
                <div class="current-player" id="current-player-display">í”Œë ˆì´ì–´ 1ì˜ ì°¨ë¡€</div>
                <div class="timer" id="timer">60</div>
            </div>

            <div class="phase-indicator">
                <div class="phase" id="phase-1">1. ì¬ë£Œ ìˆ˜ì§‘</div>
                <div class="phase" id="phase-2">2. ì¡°ë¦¬í•˜ê¸°</div>
                <div class="phase" id="phase-3">3. í”Œë ˆì´íŒ…</div>
            </div>

            <!-- 1ë‹¨ê³„: ì¬ë£Œ ì„ íƒ -->
            <div id="ingredient-phase" class="game-phase">
                <h3 style="text-align: center; margin-bottom: 10px;">ì¬ë£Œë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
                <p style="text-align: center; color: #aaa; margin-bottom: 20px;">ì£¼ì¬ë£Œ 1ê°œì™€ ë¶€ì¬ë£Œ 2ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>

                <div class="selected-ingredients">
                    <div class="selected-slot" id="main-slot">
                        <span style="font-size: 2em;">?</span>
                        <span>ì£¼ì¬ë£Œ</span>
                    </div>
                    <div class="selected-slot" id="sub-slot-1">
                        <span style="font-size: 2em;">?</span>
                        <span>ë¶€ì¬ë£Œ 1</span>
                    </div>
                    <div class="selected-slot" id="sub-slot-2">
                        <span style="font-size: 2em;">?</span>
                        <span>ë¶€ì¬ë£Œ 2</span>
                    </div>
                </div>

                <div class="synergy-display">
                    <div>í˜„ì¬ ì‹œë„ˆì§€</div>
                    <div class="synergy-score synergy-neutral" id="synergy-score">0</div>
                    <div id="synergy-message" style="color: #aaa; margin-top: 10px;"></div>
                </div>

                <div class="category-tabs" id="category-tabs"></div>
                <div class="ingredient-grid" id="ingredient-grid"></div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" id="confirm-ingredients" onclick="confirmIngredients()" disabled>ì„ íƒ ì™„ë£Œ</button>
                </div>
            </div>

            <!-- 2ë‹¨ê³„: ì¡°ë¦¬ -->
            <div id="cooking-phase" class="game-phase" style="display: none;">
                <div class="cooking-game">
                    <h3>ì¡°ë¦¬ ì‹œê°„!</h3>
                    <div class="cooking-animation" id="cooking-emoji">ğŸ³</div>
                    <div class="cooking-instructions" id="cooking-instruction">ì´ˆë¡ìƒ‰ ì˜ì—­ì—ì„œ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆ„ë¥´ì„¸ìš”!</div>

                    <div class="gauge-container">
                        <div class="gauge-target" id="gauge-target"></div>
                        <div class="gauge-indicator" id="gauge-indicator"></div>
                    </div>

                    <div class="cooking-score">ì ìˆ˜: <span id="cooking-score">0</span></div>
                    <div class="combo-display">ì½¤ë³´: <span id="combo-count">0</span>x</div>
                    <div style="margin-top: 20px;">
                        <span id="cooking-attempts">ì‹œë„: 0/5</span>
                    </div>
                </div>
            </div>

            <!-- 3ë‹¨ê³„: í”Œë ˆì´íŒ… -->
            <div id="plating-phase" class="game-phase" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 20px;">í”Œë ˆì´íŒ… & í”„ë ˆì  í…Œì´ì…˜</h3>

                <div class="plating-area">
                    <div class="plate-canvas" id="plate-canvas">
                        <span style="color: #555; font-size: 1.2em;">ë‹¹ì‹ ì˜ ìš”ë¦¬</span>
                    </div>

                    <div class="theme-selector">
                        <h4 style="color: #ffd700; margin-bottom: 15px;">í…Œë§ˆ ì„ íƒ</h4>
                        <div id="theme-options"></div>

                        <h4 style="color: #ffd700; margin: 20px 0 15px;">ì¥ì‹</h4>
                        <div class="decoration-palette" id="decoration-palette"></div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="confirmPlating()">ìš”ë¦¬ ì™„ì„±</button>
                </div>
            </div>
        </div>

        <!-- ì‹¬ì‚¬ í™”ë©´ -->
        <div id="judging-screen" class="screen">
            <div class="judging-screen">
                <h2 style="color: #ffd700; margin-bottom: 20px;">ì‹¬ì‚¬ ì‹œê°„!</h2>
                <div id="dish-presentation" style="text-align: center; margin: 20px 0;">
                    <span style="font-size: 5em;" id="final-dish-emoji">ğŸ½ï¸</span>
                </div>

                <div class="judges-panel">
                    <div class="judge-card">
                        <div class="judge-avatar">ğŸ§</div>
                        <div class="judge-name">ì‹¬ì‚¬ìœ„ì› A</div>
                        <div style="color: #aaa;">ëƒ‰ì² í•œ ë¶„ì„ê°€</div>
                        <div class="judge-score" id="judge-a-score">--</div>
                        <div class="score-breakdown" id="judge-a-breakdown"></div>
                    </div>

                    <div class="judge-card">
                        <div class="judge-avatar">ğŸ˜‹</div>
                        <div class="judge-name">ì‹¬ì‚¬ìœ„ì› B</div>
                        <div style="color: #aaa;">ê°ì„± ë¯¸ì‹ê°€</div>
                        <div class="judge-score" id="judge-b-score">--</div>
                        <div class="score-breakdown" id="judge-b-breakdown"></div>
                    </div>
                </div>

                <div class="final-score">ì´ì : <span id="total-score">--</span></div>

                <button class="btn btn-primary" id="next-turn-btn" onclick="nextTurn()">ë‹¤ìŒ</button>
            </div>
        </div>

        <!-- ë³´ìŠ¤ì „ í™”ë©´ -->
        <div id="boss-screen" class="screen">
            <div class="boss-intro">
                <h2 style="color: #ff6b6b;">ë³´ìŠ¤ì „!</h2>
                <div class="boss-portrait" id="boss-portrait">ğŸ‘¨â€ğŸ³</div>
                <div class="boss-name" id="boss-name">ë³´ìŠ¤ ì´ë¦„</div>
                <div class="boss-title" id="boss-title">ë³´ìŠ¤ ì¹­í˜¸</div>
                <p id="boss-description" style="max-width: 600px; margin: 0 auto 20px; color: #aaa;"></p>
                <div class="boss-skill">
                    <h4>ë³´ìŠ¤ ìŠ¤í‚¬: <span id="boss-skill-name"></span></h4>
                    <p id="boss-skill-desc"></p>
                </div>
                <button class="btn btn-primary" onclick="startBossBattle()" style="margin-top: 30px;">ë„ì „!</button>
            </div>
        </div>

        <!-- ë¼ìš´ë“œ ê²°ê³¼ í™”ë©´ -->
        <div id="round-results" class="screen">
            <h2 style="text-align: center; color: #ffd700; margin-bottom: 30px;">ë¼ìš´ë“œ ê²°ê³¼</h2>
            <div class="scoreboard" id="round-scoreboard"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="nextRound()">ë‹¤ìŒ ë¼ìš´ë“œ</button>
            </div>
        </div>

        <!-- ìŠ¹ë¦¬ í™”ë©´ -->
        <div id="victory-screen" class="screen">
            <div class="victory-screen">
                <div class="trophy">ğŸ†</div>
                <h2 style="color: #ff6b6b;">ìš°ìŠ¹!</h2>
                <div class="winner-name" id="winner-name">í”Œë ˆì´ì–´ 1</div>
                <p style="font-size: 1.3em; color: #aaa;">ë‹˜ì´ ìƒˆë¡œìš´ ë¯¸ì‹ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤!</p>
                <div id="final-standings" class="scoreboard" style="max-width: 500px; margin: 30px auto;"></div>
                <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 30px;">ë‹¤ì‹œ í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì´ë²¤íŠ¸ íŒì—… -->
    <div id="event-overlay" class="overlay" style="display: none;"></div>
    <div id="event-popup" class="event-popup" style="display: none;">
        <div class="event-icon" id="event-icon">âš¡</div>
        <div class="event-title" id="event-title">ëŒë°œ ì´ë²¤íŠ¸!</div>
        <p id="event-description">ì˜ˆìƒì¹˜ ëª»í•œ ì¼ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤!</p>
        <button class="btn btn-secondary" onclick="closeEvent()" style="margin-top: 20px;">ê³„ì†í•˜ê¸°</button>
    </div>

    <script>
        // ==================== ê²Œì„ ë°ì´í„° ====================

        const INGREDIENTS = {
            meat: [
                { id: 'pork', name: 'ë¼ì§€ê³ ê¸°', icon: 'ğŸ¥©', taste: 75, attribute: 'ê³ ì†Œí•¨' },
                { id: 'beef', name: 'ì†Œê³ ê¸°', icon: 'ğŸ¥“', taste: 85, attribute: 'í’ë¯¸' },
                { id: 'chicken', name: 'ë‹­ê³ ê¸°', icon: 'ğŸ—', taste: 70, attribute: 'ë‹´ë°±í•¨' },
                { id: 'duck', name: 'ì˜¤ë¦¬ê³ ê¸°', icon: 'ğŸ¦†', taste: 80, attribute: 'í’ë¯¸' },
                { id: 'lamb', name: 'ì–‘ê³ ê¸°', icon: 'ğŸ‘', taste: 78, attribute: 'ì§„í•¨' },
                { id: 'bacon', name: 'ë² ì´ì»¨', icon: 'ğŸ¥“', taste: 82, attribute: 'ì§­ì§¤í•¨' },
                { id: 'sausage', name: 'ì†Œì‹œì§€', icon: 'ğŸŒ­', taste: 70, attribute: 'ê³ ì†Œí•¨' },
                { id: 'ham', name: 'í–„', icon: 'ğŸ–', taste: 68, attribute: 'ë‹´ë°±í•¨' }
            ],
            seafood: [
                { id: 'shrimp', name: 'ìƒˆìš°', icon: 'ğŸ¦', taste: 75, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'oyster', name: 'êµ´', icon: 'ğŸ¦ª', taste: 80, attribute: 'ë°”ë‹¤í–¥' },
                { id: 'salmon', name: 'ì—°ì–´', icon: 'ğŸ£', taste: 85, attribute: 'í’ë¯¸' },
                { id: 'squid', name: 'ì˜¤ì§•ì–´', icon: 'ğŸ¦‘', taste: 70, attribute: 'ì«„ê¹ƒí•¨' },
                { id: 'crab', name: 'ê²Œ', icon: 'ğŸ¦€', taste: 90, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'eel', name: 'ì¥ì–´', icon: 'ğŸŸ', taste: 80, attribute: 'ê³ ì†Œí•¨' },
                { id: 'tuna', name: 'ì°¸ì¹˜', icon: 'ğŸŸ', taste: 88, attribute: 'ë‹´ë°±í•¨' },
                { id: 'octopus', name: 'ë¬¸ì–´', icon: 'ğŸ™', taste: 75, attribute: 'ì«„ê¹ƒí•¨' },
                { id: 'clam', name: 'ì¡°ê°œ', icon: 'ğŸš', taste: 72, attribute: 'ë°”ë‹¤í–¥' },
                { id: 'lobster', name: 'ëìŠ¤í„°', icon: 'ğŸ¦', taste: 95, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'scallop', name: 'ê°€ë¦¬ë¹„', icon: 'ğŸš', taste: 85, attribute: 'ë¶€ë“œëŸ¬ì›€' },
                { id: 'mackerel', name: 'ê³ ë“±ì–´', icon: 'ğŸŸ', taste: 75, attribute: 'ê³ ì†Œí•¨' }
            ],
            vegetable: [
                { id: 'tomato', name: 'í† ë§ˆí† ', icon: 'ğŸ…', taste: 65, attribute: 'ì‚°ëœ»í•¨' },
                { id: 'spinach', name: 'ì‹œê¸ˆì¹˜', icon: 'ğŸ¥¬', taste: 50, attribute: 'ë‹´ë°±í•¨' },
                { id: 'potato', name: 'ê°ì', icon: 'ğŸ¥”', taste: 55, attribute: 'í¬ê·¼í•¨' },
                { id: 'cucumber', name: 'ì˜¤ì´', icon: 'ğŸ¥’', taste: 45, attribute: 'ì²­ëŸ‰í•¨' },
                { id: 'radish', name: 'ë¬´', icon: 'ğŸ¥•', taste: 50, attribute: 'ì•„ì‚­í•¨' },
                { id: 'greenonion', name: 'íŒŒ', icon: 'ğŸ§…', taste: 40, attribute: 'í–¥ê¸‹í•¨' },
                { id: 'seaweed', name: 'ë¯¸ì—­', icon: 'ğŸŒ¿', taste: 55, attribute: 'ë°”ë‹¤í–¥' },
                { id: 'garlic', name: 'ë§ˆëŠ˜', icon: 'ğŸ§„', taste: 60, attribute: 'ì•Œì‹¸í•¨' },
                { id: 'onion', name: 'ì–‘íŒŒ', icon: 'ğŸ§…', taste: 55, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'carrot', name: 'ë‹¹ê·¼', icon: 'ğŸ¥•', taste: 50, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'mushroom', name: 'ë²„ì„¯', icon: 'ğŸ„', taste: 65, attribute: 'ê°ì¹ ë§›' },
                { id: 'cabbage', name: 'ì–‘ë°°ì¶”', icon: 'ğŸ¥¬', taste: 45, attribute: 'ì•„ì‚­í•¨' },
                { id: 'broccoli', name: 'ë¸Œë¡œì½œë¦¬', icon: 'ğŸ¥¦', taste: 55, attribute: 'ë‹´ë°±í•¨' },
                { id: 'pepper', name: 'í”¼ë§', icon: 'ğŸ«‘', taste: 50, attribute: 'ì•„ì‚­í•¨' },
                { id: 'corn', name: 'ì˜¥ìˆ˜ìˆ˜', icon: 'ğŸŒ½', taste: 60, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'eggplant', name: 'ê°€ì§€', icon: 'ğŸ†', taste: 55, attribute: 'ë¶€ë“œëŸ¬ì›€' },
                { id: 'zucchini', name: 'ì• í˜¸ë°•', icon: 'ğŸ¥’', taste: 50, attribute: 'ë‹´ë°±í•¨' },
                { id: 'asparagus', name: 'ì•„ìŠ¤íŒŒë¼ê±°ìŠ¤', icon: 'ğŸŒ¿', taste: 60, attribute: 'ê³ ì†Œí•¨' }
            ],
            dairy: [
                { id: 'cheese', name: 'ì¹˜ì¦ˆ', icon: 'ğŸ§€', taste: 75, attribute: 'í¬ë¦¬ë¯¸' },
                { id: 'butter', name: 'ë²„í„°', icon: 'ğŸ§ˆ', taste: 70, attribute: 'ê³ ì†Œí•¨' },
                { id: 'cream', name: 'í¬ë¦¼', icon: 'ğŸ¥›', taste: 65, attribute: 'ë¶€ë“œëŸ¬ì›€' },
                { id: 'milk', name: 'ìš°ìœ ', icon: 'ğŸ¥›', taste: 55, attribute: 'ê³ ì†Œí•¨' },
                { id: 'yogurt', name: 'ìš”ê±°íŠ¸', icon: 'ğŸ¥›', taste: 60, attribute: 'ìƒí¼í•¨' },
                { id: 'mozzarella', name: 'ëª¨ì§œë ë¼', icon: 'ğŸ§€', taste: 78, attribute: 'ì«„ê¹ƒí•¨' },
                { id: 'parmesan', name: 'íŒŒë§ˆì‚°', icon: 'ğŸ§€', taste: 85, attribute: 'ê°ì¹ ë§›' },
                { id: 'ricotta', name: 'ë¦¬ì½”íƒ€', icon: 'ğŸ§€', taste: 68, attribute: 'ë‹´ë°±í•¨' }
            ],
            fruit: [
                { id: 'lemon', name: 'ë ˆëª¬', icon: 'ğŸ‹', taste: 60, attribute: 'ìƒí¼í•¨' },
                { id: 'pear', name: 'ë°°', icon: 'ğŸ', taste: 70, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'peach', name: 'ë³µìˆ­ì•„', icon: 'ğŸ‘', taste: 75, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'apple', name: 'ì‚¬ê³¼', icon: 'ğŸ', taste: 70, attribute: 'ìƒí¼í•¨' },
                { id: 'orange', name: 'ì˜¤ë Œì§€', icon: 'ğŸŠ', taste: 68, attribute: 'ìƒí¼í•¨' },
                { id: 'grape', name: 'í¬ë„', icon: 'ğŸ‡', taste: 72, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'mango', name: 'ë§ê³ ', icon: 'ğŸ¥­', taste: 80, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'pineapple', name: 'íŒŒì¸ì• í”Œ', icon: 'ğŸ', taste: 75, attribute: 'ìƒˆì½¤í•¨' },
                { id: 'strawberry', name: 'ë”¸ê¸°', icon: 'ğŸ“', taste: 78, attribute: 'ìƒí¼í•¨' },
                { id: 'cherry', name: 'ì²´ë¦¬', icon: 'ğŸ’', taste: 72, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'lime', name: 'ë¼ì„', icon: 'ğŸ‹', taste: 58, attribute: 'ìƒí¼í•¨' },
                { id: 'avocado', name: 'ì•„ë³´ì¹´ë„', icon: 'ğŸ¥‘', taste: 70, attribute: 'ê³ ì†Œí•¨' }
            ],
            condiment: [
                { id: 'shrimpPaste', name: 'ìƒˆìš°ì “', icon: 'ğŸ«™', taste: 85, attribute: 'ê°ì¹ ë§›' },
                { id: 'soySauce', name: 'ê°„ì¥', icon: 'ğŸ¶', taste: 80, attribute: 'ê°ì¹ ë§›' },
                { id: 'oliveoil', name: 'ì˜¬ë¦¬ë¸Œìœ ', icon: 'ğŸ«’', taste: 65, attribute: 'ê³ ì†Œí•¨' },
                { id: 'basil', name: 'ë°”ì§ˆ', icon: 'ğŸŒ±', taste: 60, attribute: 'í–¥ê¸‹í•¨' },
                { id: 'tofu', name: 'ë‘ë¶€', icon: 'ğŸ§Š', taste: 45, attribute: 'ë‹´ë°±í•¨' },
                { id: 'sesameOil', name: 'ì°¸ê¸°ë¦„', icon: 'ğŸ«™', taste: 75, attribute: 'ê³ ì†Œí•¨' },
                { id: 'vinegar', name: 'ì‹ì´ˆ', icon: 'ğŸ¶', taste: 55, attribute: 'ìƒˆì½¤í•¨' },
                { id: 'honey', name: 'ê¿€', icon: 'ğŸ¯', taste: 80, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'mustard', name: 'ë¨¸ìŠ¤íƒ€ë“œ', icon: 'ğŸ«™', taste: 60, attribute: 'ì•Œì‹¸í•¨' },
                { id: 'wasabi', name: 'ì™€ì‚¬ë¹„', icon: 'ğŸŸ¢', taste: 70, attribute: 'ì•Œì‹¸í•¨' },
                { id: 'mayo', name: 'ë§ˆìš”ë„¤ì¦ˆ', icon: 'ğŸ«™', taste: 65, attribute: 'ê³ ì†Œí•¨' },
                { id: 'ketchup', name: 'ì¼€ì²©', icon: 'ğŸ…', taste: 60, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'oysterSauce', name: 'êµ´ì†ŒìŠ¤', icon: 'ğŸ«™', taste: 78, attribute: 'ê°ì¹ ë§›' },
                { id: 'fishSauce', name: 'ì•¡ì “', icon: 'ğŸ«™', taste: 82, attribute: 'ê°ì¹ ë§›' }
            ],
            fermented: [
                { id: 'kimchi', name: 'ê¹€ì¹˜', icon: 'ğŸ¥—', taste: 80, attribute: 'ë°œíš¨' },
                { id: 'miso', name: 'ëœì¥', icon: 'ğŸ¥£', taste: 85, attribute: 'ë°œíš¨' },
                { id: 'gochujang', name: 'ê³ ì¶”ì¥', icon: 'ğŸŒ¶ï¸', taste: 80, attribute: 'ë§¤ì½¤í•¨' },
                { id: 'cheonggukjang', name: 'ì²­êµ­ì¥', icon: 'ğŸ¥£', taste: 88, attribute: 'ë°œíš¨' },
                { id: 'jeotgal', name: 'ì “ê°ˆ', icon: 'ğŸ«™', taste: 85, attribute: 'ê°ì¹ ë§›' },
                { id: 'makgeolli', name: 'ë§‰ê±¸ë¦¬', icon: 'ğŸ¶', taste: 70, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'vinegar_fermented', name: 'ë°œíš¨ì‹ì´ˆ', icon: 'ğŸ¶', taste: 65, attribute: 'ìƒˆì½¤í•¨' },
                { id: 'natto', name: 'ë‚«í† ', icon: 'ğŸ«˜', taste: 75, attribute: 'ë°œíš¨' }
            ],
            grain: [
                { id: 'rice', name: 'ìŒ€', icon: 'ğŸš', taste: 60, attribute: 'ë‹´ë°±í•¨' },
                { id: 'noodle', name: 'ë©´', icon: 'ğŸœ', taste: 55, attribute: 'ì«„ê¹ƒí•¨' },
                { id: 'bread', name: 'ë¹µ', icon: 'ğŸ', taste: 58, attribute: 'ê³ ì†Œí•¨' },
                { id: 'pasta', name: 'íŒŒìŠ¤íƒ€', icon: 'ğŸ', taste: 60, attribute: 'ì«„ê¹ƒí•¨' },
                { id: 'flour', name: 'ë°€ê°€ë£¨', icon: 'ğŸŒ¾', taste: 45, attribute: 'ë‹´ë°±í•¨' },
                { id: 'oat', name: 'ê·€ë¦¬', icon: 'ğŸŒ¾', taste: 55, attribute: 'ê³ ì†Œí•¨' },
                { id: 'barley', name: 'ë³´ë¦¬', icon: 'ğŸŒ¾', taste: 52, attribute: 'êµ¬ìˆ˜í•¨' },
                { id: 'quinoa', name: 'í€´ë…¸ì•„', icon: 'ğŸŒ¾', taste: 58, attribute: 'ë‹´ë°±í•¨' }
            ],
            spice: [
                { id: 'salt', name: 'ì†Œê¸ˆ', icon: 'ğŸ§‚', taste: 50, attribute: 'ì§­ì§¤í•¨' },
                { id: 'blackPepper', name: 'í›„ì¶”', icon: 'âš«', taste: 55, attribute: 'ì•Œì‹¸í•¨' },
                { id: 'chili', name: 'ê³ ì¶§ê°€ë£¨', icon: 'ğŸŒ¶ï¸', taste: 65, attribute: 'ë§¤ì½¤í•¨' },
                { id: 'curry', name: 'ì¹´ë ˆ', icon: 'ğŸŸ¡', taste: 75, attribute: 'í–¥ê¸‹í•¨' },
                { id: 'cinnamon', name: 'ì‹œë‚˜ëª¬', icon: 'ğŸŸ¤', taste: 60, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'ginger', name: 'ìƒê°•', icon: 'ğŸ«š', taste: 65, attribute: 'ì•Œì‹¸í•¨' },
                { id: 'turmeric', name: 'ê°•í™©', icon: 'ğŸŸ¡', taste: 55, attribute: 'í–¥ê¸‹í•¨' },
                { id: 'paprika', name: 'íŒŒí”„ë¦¬ì¹´ê°€ë£¨', icon: 'ğŸ”´', taste: 58, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'rosemary', name: 'ë¡œì¦ˆë§ˆë¦¬', icon: 'ğŸŒ¿', taste: 62, attribute: 'í–¥ê¸‹í•¨' },
                { id: 'thyme', name: 'íƒ€ì„', icon: 'ğŸŒ¿', taste: 58, attribute: 'í–¥ê¸‹í•¨' },
                { id: 'oregano', name: 'ì˜¤ë ˆê°€ë…¸', icon: 'ğŸŒ¿', taste: 55, attribute: 'í–¥ê¸‹í•¨' },
                { id: 'cumin', name: 'íë¯¼', icon: 'ğŸŸ¤', taste: 60, attribute: 'í–¥ê¸‹í•¨' }
            ],
            nuts: [
                { id: 'almond', name: 'ì•„ëª¬ë“œ', icon: 'ğŸ¥œ', taste: 70, attribute: 'ê³ ì†Œí•¨' },
                { id: 'walnut', name: 'í˜¸ë‘', icon: 'ğŸ¥œ', taste: 72, attribute: 'ê³ ì†Œí•¨' },
                { id: 'peanut', name: 'ë•…ì½©', icon: 'ğŸ¥œ', taste: 68, attribute: 'ê³ ì†Œí•¨' },
                { id: 'cashew', name: 'ìºìŠˆë„›', icon: 'ğŸ¥œ', taste: 74, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'pistachio', name: 'í”¼ìŠ¤íƒ€ì¹˜ì˜¤', icon: 'ğŸŸ¢', taste: 75, attribute: 'ê³ ì†Œí•¨' },
                { id: 'pine_nut', name: 'ì£', icon: 'ğŸ¥œ', taste: 80, attribute: 'ê³ ì†Œí•¨' },
                { id: 'chestnut', name: 'ë°¤', icon: 'ğŸŒ°', taste: 72, attribute: 'ë‹¬ì½¤í•¨' },
                { id: 'sesame', name: 'ê¹¨', icon: 'âšª', taste: 70, attribute: 'ê³ ì†Œí•¨' }
            ]
        };

        // ì‹œë„ˆì§€ ê·œì¹™
        const SYNERGY_RULES = [
            // ê¸ì • ì‹œë„ˆì§€
            { ingredients: ['pork', 'shrimpPaste'], bonus: 20, message: 'í”„ë¡œí…Œì•„ì œê°€ ì†Œí™”ë¥¼ ë•ê³  ê°ì¹ ë§› ì¦í­!' },
            { ingredients: ['tomato', 'basil', 'oliveoil'], bonus: 25, message: 'ì§€ìš©ì„± ë¹„íƒ€ë¯¼ í¡ìˆ˜ì™€ í–¥ë¯¸ì˜ ê· í˜•!' },
            { ingredients: ['tomato', 'basil'], bonus: 15, message: 'í´ë˜ì‹í•œ ì´íƒˆë¦¬ì•ˆ ì¡°í•©!' },
            { ingredients: ['tomato', 'oliveoil'], bonus: 10, message: 'ì§€ìš©ì„± ë¹„íƒ€ë¯¼ í¡ìˆ˜ ì¦ê°€!' },
            { ingredients: ['beef', 'pear'], bonus: 15, message: 'ë°°ì˜ ì—°ìœ¡ íš¨ì†Œê°€ ê³ ê¸°ë¥¼ ë¶€ë“œëŸ½ê²Œ!' },
            { ingredients: ['oyster', 'lemon'], bonus: 20, message: 'ë¹„íƒ€ë¯¼ Cê°€ ì² ë¶„ í¡ìˆ˜ë¥¼ ë•ê³  ë¹„ë¦°ë‚´ ì œê±°!' },
            { ingredients: ['potato', 'cheese'], bonus: 15, message: 'ë¹„íƒ€ë¯¼ê³¼ ë‹¨ë°±ì§ˆ, ì¹¼ìŠ˜ì˜ ì™„ë²½í•œ ì¡°í™”!' },
            { ingredients: ['chicken', 'lemon'], bonus: 10, message: 'ìƒí¼í•œ ë ˆëª¬ì´ ë‹­ê³ ê¸°ì˜ í’ë¯¸ë¥¼ ì‚´ë¦¼!' },
            { ingredients: ['salmon', 'cream'], bonus: 15, message: 'í¬ë¦¬ë¯¸í•œ ì†ŒìŠ¤ì™€ ì—°ì–´ì˜ í™˜ìƒ ì¡°í•©!' },
            { ingredients: ['shrimp', 'butter'], bonus: 12, message: 'ë²„í„° ì‰¬ë¦¼í”„ì˜ ê³ ì†Œí•œ ë§›!' },
            { ingredients: ['beef', 'soySauce'], bonus: 10, message: 'ê°„ì¥ì´ ì†Œê³ ê¸°ì˜ ê°ì¹ ë§›ì„ ì¦í­!' },
            { ingredients: ['pork', 'kimchi'], bonus: 18, message: 'ê¹€ì¹˜ì°Œê°œì˜ ê¹Šì€ ë§›!' },
            { ingredients: ['tofu', 'miso'], bonus: 12, message: 'ì¼ë³¸ ì „í†µì˜ ë§›!' },
            { ingredients: ['crab', 'butter'], bonus: 15, message: 'ë²„í„° í¬ë©ì˜ ì§„í•œ í’ë¯¸!' },
            { ingredients: ['lamb', 'rosemary'], bonus: 18, message: 'ë¡œì¦ˆë§ˆë¦¬ê°€ ì–‘ê³ ê¸°ì˜ ëˆ„ë¦°ë‚´ë¥¼ ì¡ì•„ì¤Œ!' },
            { ingredients: ['duck', 'orange'], bonus: 16, message: 'ì˜¤ë Œì§€ ë•ì˜ í´ë˜ì‹í•œ ì¡°í•©!' },
            { ingredients: ['tuna', 'avocado'], bonus: 14, message: 'ì°¸ì¹˜ì™€ ì•„ë³´ì¹´ë„ì˜ ë¶€ë“œëŸ¬ìš´ ì¡°í™”!' },
            { ingredients: ['lobster', 'butter'], bonus: 20, message: 'ë²„í„° ëìŠ¤í„°ì˜ ëŸ­ì…”ë¦¬í•œ í’ë¯¸!' },
            { ingredients: ['pasta', 'parmesan'], bonus: 15, message: 'íŒŒìŠ¤íƒ€ì˜ ì •ì„ ì¡°í•©!' },
            { ingredients: ['rice', 'sesameOil'], bonus: 12, message: 'ì°¸ê¸°ë¦„ í–¥ì´ ë°¥ë§›ì„ ì‚´ë¦¼!' },
            { ingredients: ['mushroom', 'cream'], bonus: 14, message: 'í¬ë¦¼ ë²„ì„¯ì˜ ê¹Šì€ ë§›!' },
            { ingredients: ['bacon', 'cheese'], bonus: 13, message: 'ë² ì´ì»¨ ì¹˜ì¦ˆì˜ ê³ ì†Œí•¨!' },
            { ingredients: ['mango', 'shrimp'], bonus: 15, message: 'ë§ê³  ìƒˆìš°ì˜ ë‹¬ì½¤í•œ ì¡°í•©!' },
            { ingredients: ['garlic', 'butter'], bonus: 16, message: 'ê°ˆë¦­ ë²„í„°ì˜ í™©ê¸ˆ ì¡°í•©!' },
            { ingredients: ['honey', 'ginger'], bonus: 12, message: 'ìƒê°•ê³¼ ê¿€ì˜ ê±´ê°•í•œ ì‹œë„ˆì§€!' },
            { ingredients: ['almond', 'honey'], bonus: 10, message: 'ì•„ëª¬ë“œì™€ ê¿€ì˜ ë‹¬ì½¤í•œ ì¡°í™”!' },
            { ingredients: ['pine_nut', 'basil'], bonus: 14, message: 'ì œë…¸ë² ì œì˜ í•µì‹¬ ì¬ë£Œ!' },
            { ingredients: ['scallop', 'butter'], bonus: 18, message: 'ë²„í„° ê°€ë¦¬ë¹„ì˜ ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë§›!' },
            { ingredients: ['curry', 'rice'], bonus: 15, message: 'ì¹´ë ˆë¼ì´ìŠ¤ì˜ ì™„ë²½í•œ ì¡°í•©!' },
            { ingredients: ['gochujang', 'pork'], bonus: 16, message: 'ì œìœ¡ë³¶ìŒì˜ ë§¤ì½¤í•œ ë§›!' },

            // ë¶€ì • ì‹œë„ˆì§€
            { ingredients: ['seaweed', 'greenonion'], bonus: -15, message: 'íŒŒê°€ ë¯¸ì—­ì˜ ì¹¼ìŠ˜ í¡ìˆ˜ë¥¼ ë°©í•´!' },
            { ingredients: ['spinach', 'tofu'], bonus: -20, message: 'ì‹œê¸ˆì¹˜ì˜ ì˜¥ì‚´ì‚°ì´ ë‘ë¶€ì˜ ì¹¼ìŠ˜ê³¼ ê²°í•©!' },
            { ingredients: ['cucumber', 'radish'], bonus: -10, message: 'ì˜¤ì´ì˜ íš¨ì†Œê°€ ë¬´ì˜ ë¹„íƒ€ë¯¼ Cë¥¼ íŒŒê´´!' },
            { ingredients: ['eel', 'peach'], bonus: -25, message: 'ë³µìˆ­ì•„ì˜ ìœ ê¸°ì‚°ì´ ì¥ì–´ì˜ ì†Œí™”ë¥¼ ë°©í•´!' },
            { ingredients: ['crab', 'persimmon'], bonus: -20, message: 'ê²Œì™€ ê°ì˜ ìƒê·¹ ì¡°í•©!' },
            { ingredients: ['milk', 'lemon'], bonus: -15, message: 'ìš°ìœ ì™€ ë ˆëª¬ì´ ì‘ê³ ë¨!' },
            { ingredients: ['honey', 'garlic'], bonus: -10, message: 'ê¿€ê³¼ ë§ˆëŠ˜ì˜ ì–´ìƒ‰í•œ ì¡°í•©!' }
        ];

        const THEMES = [
            { id: 'memory', name: 'ì¶”ì–µ', icon: 'ğŸ“¸', matchIngredients: ['kimchi', 'miso', 'pork', 'beef', 'rice', 'gochujang'] },
            { id: 'challenge', name: 'ë„ì „', icon: 'ğŸ”¥', matchIngredients: ['gochujang', 'eel', 'crab', 'lobster', 'chili', 'wasabi'] },
            { id: 'sea', name: 'ë°”ë‹¤', icon: 'ğŸŒŠ', matchIngredients: ['oyster', 'salmon', 'seaweed', 'shrimp', 'crab', 'squid', 'tuna', 'lobster', 'scallop'] },
            { id: 'garden', name: 'ì •ì›', icon: 'ğŸŒ¸', matchIngredients: ['tomato', 'basil', 'spinach', 'cucumber', 'broccoli', 'asparagus'] },
            { id: 'comfort', name: 'ë”°ëœ»í•¨', icon: 'ğŸ ', matchIngredients: ['potato', 'cheese', 'butter', 'cream', 'rice', 'bread'] },
            { id: 'elegance', name: 'ìš°ì•„í•¨', icon: 'âœ¨', matchIngredients: ['salmon', 'oyster', 'cream', 'lemon', 'lobster', 'truffle'] },
            { id: 'spicy', name: 'ì—´ì •', icon: 'ğŸŒ¶ï¸', matchIngredients: ['gochujang', 'chili', 'curry', 'ginger', 'wasabi', 'kimchi'] },
            { id: 'sweet', name: 'ë‹¬ì½¤í•¨', icon: 'ğŸ°', matchIngredients: ['honey', 'mango', 'strawberry', 'cream', 'chocolate', 'cherry'] }
        ];

        const DECORATIONS = ['ğŸŒ¿', 'ğŸŒ¸', 'ğŸƒ', 'ğŸŒº', 'ğŸ’«', 'âœ¨', 'ğŸ”¥', 'â„ï¸', 'ğŸŒ™', 'â­', 'ğŸ¨', 'ğŸ’', 'ğŸŒ¹', 'ğŸ€', 'ğŸ’', 'ğŸ­'];

        const BOSSES = [
            {
                id: 'kangchulsoo',
                name: 'ê°•ì² ìˆ˜',
                title: 'ë°œíš¨ì˜ ë§ˆìŠ¤í„°, ì¢…ê°“ì§‘ ì¥ì†',
                icon: 'ğŸ‘´',
                description: 'ì •í†µ í•œì‹ì„ ê³ ìˆ˜í•˜ë©° ì¥ë¥˜ì™€ ë°œíš¨ ìŒì‹ì„ ì£¼ë¬´ê¸°ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.',
                skillName: 'ê°„ì„­',
                skillDesc: 'í”Œë ˆì´ì–´ê°€ ì„ íƒí•œ ì¬ë£Œ ì¤‘ í•˜ë‚˜ë¥¼ ê°•ì œë¡œ í•˜ê¸‰ ì¬ë£Œë¡œ êµì²´í•©ë‹ˆë‹¤.',
                skillEffect: 'downgrade',
                fame_required: 80
            },
            {
                id: 'edwardlian',
                name: 'ì—ë“œì›Œë“œ ë¦¬ì•ˆ',
                title: 'ë¶„ì ìš”ë¦¬ì˜ ì—°ê¸ˆìˆ ì‚¬',
                icon: 'ğŸ§‘â€ğŸ”¬',
                description: 'ìš”ë¦¬ë¥¼ ê³¼í•™ìœ¼ë¡œ ì ‘ê·¼í•˜ë©° ë¶„ì ìš”ë¦¬ ê¸°ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.',
                skillName: 'ë³µì¡ì„±',
                skillDesc: 'ì¡°ë¦¬ ê³µì • ë‚œì´ë„ë¥¼ ëŒ€í­ ìƒìŠ¹ì‹œí‚¤ê³  ë¯¸ë‹ˆ ê²Œì„ ì†ë„ë¥¼ 1.5ë°° ë¹ ë¥´ê²Œ ë§Œë“­ë‹ˆë‹¤.',
                skillEffect: 'difficulty',
                fame_required: 180
            },
            {
                id: 'chefchen',
                name: 'ë§ˆì™• ì²¸',
                title: 'í™”ì—¼ì˜ ì§€ë°°ì',
                icon: 'ğŸ‘¨â€ğŸ³',
                description: 'ì¤‘ì‹ì„ ê¸°ë°˜ìœ¼ë¡œ í™”ë ¥ì„ ììœ ìì¬ë¡œ ë‹¤ë£¨ë©° ì†ë„ì™€ í™”ë ¤í•¨ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤.',
                skillName: 'ì‹œê°„ ì••ë°•',
                skillDesc: 'í”Œë ˆì´ì–´ì˜ ì „ì²´ ì¡°ë¦¬ ì‹œê°„ì„ 30% ë‹¨ì¶•ì‹œí‚µë‹ˆë‹¤.',
                skillEffect: 'time',
                fame_required: 300
            }
        ];

        const RANDOM_EVENTS = [
            { id: 'fire', title: 'ë¶ˆ ì¡°ì ˆ ì‹¤íŒ¨!', desc: 'ë¶ˆì´ ë„ˆë¬´ ì„¸ì ¸ì„œ ë‹¤ì‹œ ì¡°ì ˆí•´ì•¼ í•©ë‹ˆë‹¤.', effect: 'reduce_score', value: -10, icon: 'ğŸ”¥' },
            { id: 'inspiration', title: 'ìš”ë¦¬ì˜ ì˜ê°!', desc: 'ê°‘ìê¸° ì¢‹ì€ ì•„ì´ë””ì–´ê°€ ë– ì˜¬ëìŠµë‹ˆë‹¤!', effect: 'add_score', value: 15, icon: 'ğŸ’¡' },
            { id: 'drop', title: 'ì¬ë£Œ ë‚™í•˜!', desc: 'ì¬ë£Œë¥¼ ë–¨ì–´ëœ¨ë ¸ìŠµë‹ˆë‹¤!', effect: 'reduce_score', value: -15, icon: 'ğŸ˜±' },
            { id: 'perfect', title: 'í¼í™íŠ¸ íƒ€ì´ë°!', desc: 'ì™„ë²½í•œ íƒ€ì´ë°ìœ¼ë¡œ ìš”ë¦¬í–ˆìŠµë‹ˆë‹¤!', effect: 'add_score', value: 20, icon: 'â­' },
            { id: 'judge', title: 'ì‹¬ì‚¬ìœ„ì› í˜¸ê°!', desc: 'ì‹¬ì‚¬ìœ„ì›ì´ ë‹¹ì‹ ì˜ ìš”ë¦¬ì— ê´€ì‹¬ì„ ë³´ì…ë‹ˆë‹¤.', effect: 'judge_bonus', value: 10, icon: 'ğŸ˜Š' },
            { id: 'secret', title: 'ë¹„ë°€ ì¬ë£Œ ë°œê²¬!', desc: 'ìˆ¨ê²¨ì§„ ì¬ë£Œë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!', effect: 'add_score', value: 12, icon: 'ğŸ' },
            { id: 'burn', title: 'ì‚´ì§ íƒ”ì–´ìš”!', desc: 'ìš”ë¦¬ê°€ ì‚´ì§ íƒ”ìŠµë‹ˆë‹¤.', effect: 'reduce_score', value: -8, icon: 'ğŸ’¨' }
        ];

        const TIERS = [
            { name: 'ì–¸ë”ë…', fame: 0, class: 'tier-underdog' },
            { name: 'ì±Œë¦°ì €', fame: 80, class: 'tier-challenger' },
            { name: 'ì¥ì¸', fame: 180, class: 'tier-artisan' },
            { name: 'ë§ˆìŠ¤í„°', fame: 300, class: 'tier-master' },
            { name: 'ë¡œì—´ ë§ˆìŠ¤í„°', fame: 450, class: 'tier-royal' }
        ];

        // ==================== ê²Œì„ ìƒíƒœ ====================

        let gameState = {
            players: [],
            currentPlayerIndex: 0,
            currentRound: 1,
            totalRounds: 4,
            phase: 1,
            selectedIngredients: { main: null, sub1: null, sub2: null },
            cookingScore: 0,
            platingScore: 0,
            selectedTheme: null,
            decorations: [],
            timerInterval: null,
            timeRemaining: 60,
            cookingAttempts: 0,
            maxCookingAttempts: 5,
            comboCount: 0,
            gaugeSpeed: 3,
            gaugeDirection: 1,
            gaugePosition: 0,
            isGaugeRunning: false,
            currentBoss: null,
            bossActive: false,
            defeatedBosses: [],
            currentCategory: 'meat'
        };

        // ==================== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ====================

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function setPlayerCount(count) {
            document.querySelectorAll('.player-count-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');

            const container = document.getElementById('player-names');
            container.innerHTML = '';

            for (let i = 1; i <= count; i++) {
                container.innerHTML += `
                    <div class="player-input">
                        <label>í”Œë ˆì´ì–´ ${i}</label>
                        <input type="text" id="player-name-${i}" placeholder="ì´ë¦„ ì…ë ¥" value="í”Œë ˆì´ì–´ ${i}">
                    </div>
                `;
            }
        }

        function startGame() {
            const inputs = document.querySelectorAll('#player-names input');
            if (inputs.length < 2) {
                alert('ë¨¼ì € í”Œë ˆì´ì–´ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            gameState.players = [];
            inputs.forEach((input, index) => {
                gameState.players.push({
                    name: input.value || `í”Œë ˆì´ì–´ ${index + 1}`,
                    fame: 0,
                    totalScore: 0,
                    roundScores: []
                });
            });

            gameState.currentRound = 1;
            gameState.currentPlayerIndex = 0;
            gameState.defeatedBosses = [];

            document.getElementById('total-rounds').textContent = gameState.totalRounds;

            startRound();
        }

        function startRound() {
            showScreen('game-screen');
            document.getElementById('current-round').textContent = gameState.currentRound;
            startPlayerTurn();
        }

        function startPlayerTurn() {
            const player = gameState.players[gameState.currentPlayerIndex];
            document.getElementById('current-player-display').textContent = `${player.name}ì˜ ì°¨ë¡€`;

            gameState.phase = 1;
            gameState.selectedIngredients = { main: null, sub1: null, sub2: null };
            gameState.cookingScore = 0;
            gameState.platingScore = 0;
            gameState.selectedTheme = null;
            gameState.decorations = [];
            gameState.cookingAttempts = 0;
            gameState.comboCount = 0;

            const nextBoss = BOSSES.find(b =>
                player.fame >= b.fame_required &&
                !gameState.defeatedBosses.includes(b.id)
            );

            if (nextBoss && !gameState.bossActive) {
                showBossIntro(nextBoss);
                return;
            }

            updatePhaseIndicator();
            showIngredientPhase();
        }

        function updatePhaseIndicator() {
            for (let i = 1; i <= 3; i++) {
                const phase = document.getElementById(`phase-${i}`);
                phase.classList.remove('active', 'completed');
                if (i < gameState.phase) {
                    phase.classList.add('completed');
                } else if (i === gameState.phase) {
                    phase.classList.add('active');
                }
            }
        }

        // ==================== 1ë‹¨ê³„: ì¬ë£Œ ì„ íƒ ====================

        function showIngredientPhase() {
            document.querySelectorAll('.game-phase').forEach(p => p.style.display = 'none');
            document.getElementById('ingredient-phase').style.display = 'block';

            renderCategoryTabs();
            renderIngredients('meat');
            updateSelectedSlots();
            updateSynergyDisplay();

            let timeLimit = 60;
            if (gameState.bossActive && gameState.currentBoss.skillEffect === 'time') {
                timeLimit = Math.floor(timeLimit * 0.7);
            }

            startTimer(timeLimit, () => {
                if (gameState.selectedIngredients.main) {
                    confirmIngredients();
                } else {
                    autoSelectIngredients();
                    confirmIngredients();
                }
            });
        }

        function renderCategoryTabs() {
            const container = document.getElementById('category-tabs');
            const categories = Object.keys(INGREDIENTS);
            const categoryNames = {
                meat: 'ìœ¡ë¥˜', seafood: 'í•´ì‚°ë¬¼', vegetable: 'ì±„ì†Œ',
                dairy: 'ìœ ì œí’ˆ', fruit: 'ê³¼ì¼', condiment: 'ì–‘ë…/ì†ŒìŠ¤',
                fermented: 'ë°œíš¨', grain: 'ê³¡ë¬¼', spice: 'í–¥ì‹ ë£Œ', nuts: 'ê²¬ê³¼ë¥˜'
            };

            container.innerHTML = categories.map(cat =>
                `<button class="category-tab ${cat === 'meat' ? 'active' : ''}" onclick="renderIngredients('${cat}')">${categoryNames[cat]}</button>`
            ).join('');
        }

        function renderIngredients(category) {
            gameState.currentCategory = category;
            document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
            event?.target?.classList.add('active');

            const grid = document.getElementById('ingredient-grid');
            const ingredients = INGREDIENTS[category];

            grid.innerHTML = ingredients.map(ing => {
                const isSelected = Object.values(gameState.selectedIngredients).some(s => s?.id === ing.id);
                const isDisabled = checkBossDowngrade(ing);

                return `
                    <div class="ingredient-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}"
                         onclick="selectIngredient('${ing.id}', '${category}')">
                        <div class="ingredient-icon">${ing.icon}</div>
                        <div class="ingredient-name">${ing.name}</div>
                        <div class="ingredient-stats">ë§›: ${ing.taste} | ${ing.attribute}</div>
                    </div>
                `;
            }).join('');
        }

        function checkBossDowngrade(ingredient) {
            if (gameState.bossActive && gameState.currentBoss.skillEffect === 'downgrade') {
                return ingredient.taste >= 80 && Math.random() < 0.3;
            }
            return false;
        }

        function selectIngredient(id, category) {
            const ingredients = INGREDIENTS[category];
            const ingredient = ingredients.find(i => i.id === id);

            if (!ingredient || checkBossDowngrade(ingredient)) return;

            const slots = gameState.selectedIngredients;
            if (Object.values(slots).some(s => s?.id === id)) {
                if (slots.main?.id === id) slots.main = null;
                else if (slots.sub1?.id === id) slots.sub1 = null;
                else if (slots.sub2?.id === id) slots.sub2 = null;
            } else {
                if (!slots.main) {
                    slots.main = ingredient;
                } else if (!slots.sub1) {
                    slots.sub1 = ingredient;
                } else if (!slots.sub2) {
                    slots.sub2 = ingredient;
                }
            }

            renderIngredients(category);
            updateSelectedSlots();
            updateSynergyDisplay();

            const allFilled = slots.main && slots.sub1 && slots.sub2;
            document.getElementById('confirm-ingredients').disabled = !allFilled;
        }

        function updateSelectedSlots() {
            const slots = gameState.selectedIngredients;

            ['main', 'sub1', 'sub2'].forEach((slotKey, index) => {
                const slotId = index === 0 ? 'main-slot' : `sub-slot-${index}`;
                const slot = document.getElementById(slotId);
                const ingredient = slots[slotKey];

                if (ingredient) {
                    slot.innerHTML = `
                        <span style="font-size: 2em;">${ingredient.icon}</span>
                        <span>${ingredient.name}</span>
                    `;
                    slot.classList.add('filled');
                } else {
                    const labels = ['ì£¼ì¬ë£Œ', 'ë¶€ì¬ë£Œ 1', 'ë¶€ì¬ë£Œ 2'];
                    slot.innerHTML = `
                        <span style="font-size: 2em;">?</span>
                        <span>${labels[index]}</span>
                    `;
                    slot.classList.remove('filled');
                }
            });
        }

        function updateSynergyDisplay() {
            const slots = gameState.selectedIngredients;
            const selectedIds = [slots.main?.id, slots.sub1?.id, slots.sub2?.id].filter(Boolean);

            let totalSynergy = 0;
            let messages = [];

            SYNERGY_RULES.forEach(rule => {
                const matchCount = rule.ingredients.filter(ing => selectedIds.includes(ing)).length;
                if (matchCount === rule.ingredients.length) {
                    totalSynergy += rule.bonus;
                    messages.push(rule.message);
                }
            });

            const scoreEl = document.getElementById('synergy-score');
            scoreEl.textContent = (totalSynergy >= 0 ? '+' : '') + totalSynergy;
            scoreEl.className = 'synergy-score ' + (totalSynergy > 0 ? 'synergy-positive' : totalSynergy < 0 ? 'synergy-negative' : 'synergy-neutral');

            document.getElementById('synergy-message').textContent = messages.join(' ');
        }

        function calculateSynergy() {
            const slots = gameState.selectedIngredients;
            const selectedIds = [slots.main?.id, slots.sub1?.id, slots.sub2?.id].filter(Boolean);

            let totalSynergy = 50;

            SYNERGY_RULES.forEach(rule => {
                const matchCount = rule.ingredients.filter(ing => selectedIds.includes(ing)).length;
                if (matchCount === rule.ingredients.length) {
                    totalSynergy += rule.bonus;
                }
            });

            return Math.max(0, Math.min(100, totalSynergy));
        }

        function autoSelectIngredients() {
            const allIngredients = Object.values(INGREDIENTS).flat();
            const shuffled = allIngredients.sort(() => Math.random() - 0.5);

            gameState.selectedIngredients = {
                main: shuffled[0],
                sub1: shuffled[1],
                sub2: shuffled[2]
            };
        }

        function confirmIngredients() {
            stopTimer();
            gameState.phase = 2;
            updatePhaseIndicator();
            showCookingPhase();
        }

        // ==================== 2ë‹¨ê³„: ì¡°ë¦¬ ë¯¸ë‹ˆê²Œì„ ====================

        function showCookingPhase() {
            document.querySelectorAll('.game-phase').forEach(p => p.style.display = 'none');
            document.getElementById('cooking-phase').style.display = 'block';

            gameState.cookingScore = 0;
            gameState.cookingAttempts = 0;
            gameState.comboCount = 0;

            gameState.gaugeSpeed = 3;
            if (gameState.bossActive && gameState.currentBoss.skillEffect === 'difficulty') {
                gameState.gaugeSpeed = 4.5;
            }

            document.getElementById('cooking-score').textContent = '0';
            document.getElementById('combo-count').textContent = '0';
            document.getElementById('cooking-attempts').textContent = `ì‹œë„: 0/${gameState.maxCookingAttempts}`;

            setNewTarget();
            startGauge();

            document.addEventListener('keydown', handleCookingInput);
        }

        function setNewTarget() {
            const targetEl = document.getElementById('gauge-target');
            const targetWidth = 15 + Math.random() * 10;
            const targetLeft = 10 + Math.random() * (75 - targetWidth);

            targetEl.style.width = targetWidth + '%';
            targetEl.style.left = targetLeft + '%';

            gameState.targetZone = {
                left: targetLeft,
                right: targetLeft + targetWidth
            };
        }

        function startGauge() {
            gameState.gaugePosition = 0;
            gameState.gaugeDirection = 1;
            gameState.isGaugeRunning = true;

            const indicator = document.getElementById('gauge-indicator');

            function updateGauge() {
                if (!gameState.isGaugeRunning) return;

                gameState.gaugePosition += gameState.gaugeSpeed * gameState.gaugeDirection;

                if (gameState.gaugePosition >= 100) {
                    gameState.gaugePosition = 100;
                    gameState.gaugeDirection = -1;
                } else if (gameState.gaugePosition <= 0) {
                    gameState.gaugePosition = 0;
                    gameState.gaugeDirection = 1;
                }

                indicator.style.left = gameState.gaugePosition + '%';

                requestAnimationFrame(updateGauge);
            }

            requestAnimationFrame(updateGauge);
        }

        function handleCookingInput(e) {
            if (e.code === 'Space' && gameState.phase === 2 && gameState.isGaugeRunning) {
                e.preventDefault();
                checkCookingHit();
            }
        }

        function checkCookingHit() {
            gameState.cookingAttempts++;

            const pos = gameState.gaugePosition;
            const target = gameState.targetZone;

            let points = 0;

            if (pos >= target.left && pos <= target.right) {
                const center = (target.left + target.right) / 2;
                const distance = Math.abs(pos - center);
                const maxDistance = (target.right - target.left) / 2;
                const precision = 1 - (distance / maxDistance);

                points = Math.floor(10 + precision * 10);
                gameState.comboCount++;

                if (gameState.comboCount >= 3) {
                    points += gameState.comboCount * 2;
                }

                document.getElementById('cooking-emoji').textContent = 'ğŸ”¥';
            } else {
                gameState.comboCount = 0;
                document.getElementById('cooking-emoji').textContent = 'ğŸ˜…';
                document.getElementById('cooking-emoji').classList.add('shake');
                setTimeout(() => document.getElementById('cooking-emoji').classList.remove('shake'), 500);
            }

            gameState.cookingScore += points;
            document.getElementById('cooking-score').textContent = gameState.cookingScore;
            document.getElementById('combo-count').textContent = gameState.comboCount;
            document.getElementById('cooking-attempts').textContent = `ì‹œë„: ${gameState.cookingAttempts}/${gameState.maxCookingAttempts}`;

            if (gameState.cookingAttempts >= gameState.maxCookingAttempts) {
                endCookingPhase();
            } else {
                setNewTarget();
            }
        }

        function endCookingPhase() {
            gameState.isGaugeRunning = false;
            document.removeEventListener('keydown', handleCookingInput);

            if (Math.random() < 0.3) {
                triggerRandomEvent();
            }

            setTimeout(() => {
                gameState.phase = 3;
                updatePhaseIndicator();
                showPlatingPhase();
            }, 1000);
        }

        function triggerRandomEvent() {
            const event = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];

            document.getElementById('event-icon').textContent = event.icon;
            document.getElementById('event-title').textContent = event.title;
            document.getElementById('event-description').textContent = event.desc;

            document.getElementById('event-overlay').style.display = 'block';
            document.getElementById('event-popup').style.display = 'block';

            if (event.effect === 'add_score' || event.effect === 'reduce_score') {
                gameState.cookingScore = Math.max(0, gameState.cookingScore + event.value);
                document.getElementById('cooking-score').textContent = gameState.cookingScore;
            } else if (event.effect === 'judge_bonus') {
                gameState.judgeBonus = event.value;
            }
        }

        function closeEvent() {
            document.getElementById('event-overlay').style.display = 'none';
            document.getElementById('event-popup').style.display = 'none';
        }

        // ==================== 3ë‹¨ê³„: í”Œë ˆì´íŒ… ====================

        function showPlatingPhase() {
            document.querySelectorAll('.game-phase').forEach(p => p.style.display = 'none');
            document.getElementById('plating-phase').style.display = 'block';

            renderThemeOptions();
            renderDecorationPalette();
            setupPlateCanvas();

            let timeLimit = 45;
            if (gameState.bossActive && gameState.currentBoss.skillEffect === 'time') {
                timeLimit = Math.floor(timeLimit * 0.7);
            }

            startTimer(timeLimit, confirmPlating);
        }

        function renderThemeOptions() {
            const container = document.getElementById('theme-options');
            container.innerHTML = THEMES.map(theme => `
                <div class="theme-option" onclick="selectTheme('${theme.id}')">
                    <span style="font-size: 1.5em;">${theme.icon}</span>
                    <span style="margin-left: 10px;">${theme.name}</span>
                </div>
            `).join('');
        }

        function selectTheme(themeId) {
            gameState.selectedTheme = THEMES.find(t => t.id === themeId);

            document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.theme-option').classList.add('selected');
        }

        function renderDecorationPalette() {
            const container = document.getElementById('decoration-palette');
            container.innerHTML = DECORATIONS.map(dec =>
                `<div class="decoration-item" onclick="addDecoration('${dec}')">${dec}</div>`
            ).join('');
        }

        function setupPlateCanvas() {
            const canvas = document.getElementById('plate-canvas');
            const mainIngredient = gameState.selectedIngredients.main;

            canvas.innerHTML = `
                <span style="font-size: 4em;">${mainIngredient?.icon || 'ğŸ½ï¸'}</span>
            `;
            gameState.decorations = [];
        }

        function addDecoration(emoji) {
            if (gameState.decorations.length >= 5) return;

            const canvas = document.getElementById('plate-canvas');
            const decoration = document.createElement('div');
            decoration.className = 'plate-decoration';
            decoration.textContent = emoji;
            decoration.style.left = (20 + Math.random() * 60) + '%';
            decoration.style.top = (20 + Math.random() * 60) + '%';

            canvas.appendChild(decoration);
            gameState.decorations.push(emoji);
        }

        function confirmPlating() {
            stopTimer();
            calculateFinalScore();
        }

        // ==================== ì ìˆ˜ ê³„ì‚° ====================

        function calculateFinalScore() {
            const synergy = calculateSynergy();
            const cookingScore = Math.min(100, gameState.cookingScore);

            const platingHarmony = Math.min(100, 50 + gameState.decorations.length * 10);

            let themeMatch = 50;
            if (gameState.selectedTheme) {
                const selectedIds = [
                    gameState.selectedIngredients.main?.id,
                    gameState.selectedIngredients.sub1?.id,
                    gameState.selectedIngredients.sub2?.id
                ].filter(Boolean);

                const matches = selectedIds.filter(id =>
                    gameState.selectedTheme.matchIngredients.includes(id)
                ).length;

                themeMatch = 50 + matches * 15;
            }

            const eventBonus = gameState.judgeBonus || 0;
            const judgeAScore = Math.round(
                (cookingScore * 0.5) +
                (synergy * 0.3) +
                ((cookingScore + eventBonus) * 0.2)
            );

            const judgeBScore = Math.round(
                (platingHarmony * 0.4) +
                (themeMatch * 0.4) +
                (synergy * 0.2)
            );

            const totalScore = judgeAScore + judgeBScore;

            if (gameState.bossActive) {
                const bossScore = 120 + Math.floor(Math.random() * 30);
                showJudgingScreen(judgeAScore, judgeBScore, totalScore, synergy, cookingScore, platingHarmony, themeMatch, bossScore);
            } else {
                showJudgingScreen(judgeAScore, judgeBScore, totalScore, synergy, cookingScore, platingHarmony, themeMatch);
            }
        }

        function showJudgingScreen(judgeA, judgeB, total, synergy, cooking, plating, theme, bossScore = null) {
            showScreen('judging-screen');

            const mainIng = gameState.selectedIngredients.main;
            document.getElementById('final-dish-emoji').textContent = mainIng?.icon || 'ğŸ½ï¸';

            setTimeout(() => {
                document.getElementById('judge-a-score').textContent = judgeA;
                document.getElementById('judge-a-breakdown').innerHTML = `
                    <div><span>ì¡°ë¦¬:</span><span>${Math.round(cooking * 0.5)}</span></div>
                    <div><span>ì‹œë„ˆì§€:</span><span>${Math.round(synergy * 0.3)}</span></div>
                    <div><span>ëŒ€ì²˜:</span><span>${Math.round(cooking * 0.2)}</span></div>
                `;
            }, 500);

            setTimeout(() => {
                document.getElementById('judge-b-score').textContent = judgeB;
                document.getElementById('judge-b-breakdown').innerHTML = `
                    <div><span>í”Œë ˆì´íŒ…:</span><span>${Math.round(plating * 0.4)}</span></div>
                    <div><span>í…Œë§ˆ:</span><span>${Math.round(theme * 0.4)}</span></div>
                    <div><span>ì‹œë„ˆì§€:</span><span>${Math.round(synergy * 0.2)}</span></div>
                `;
            }, 1000);

            setTimeout(() => {
                document.getElementById('total-score').textContent = total;

                if (bossScore !== null) {
                    const resultText = total > bossScore ?
                        `ìŠ¹ë¦¬! (ë³´ìŠ¤: ${bossScore})` :
                        `íŒ¨ë°°... (ë³´ìŠ¤: ${bossScore})`;
                    document.getElementById('total-score').textContent = `${total} - ${resultText}`;

                    if (total > bossScore) {
                        gameState.defeatedBosses.push(gameState.currentBoss.id);
                    }
                }
            }, 1500);

            const player = gameState.players[gameState.currentPlayerIndex];
            player.roundScores.push(total);
            player.totalScore += total;
            player.fame += Math.floor(total / 2);

            gameState.bossActive = false;
            gameState.currentBoss = null;
            gameState.judgeBonus = 0;
        }

        function nextTurn() {
            gameState.currentPlayerIndex++;

            if (gameState.currentPlayerIndex >= gameState.players.length) {
                showRoundResults();
            } else {
                startPlayerTurn();
            }
        }

        function showRoundResults() {
            showScreen('round-results');

            const scoreboard = document.getElementById('round-scoreboard');
            const sortedPlayers = [...gameState.players].sort((a, b) => b.totalScore - a.totalScore);

            scoreboard.innerHTML = sortedPlayers.map((player, index) => {
                const tier = TIERS.filter(t => player.fame >= t.fame).pop();
                const roundScore = player.roundScores[gameState.currentRound - 1] || 0;

                return `
                    <div class="scoreboard-row">
                        <div class="player-rank">#${index + 1}</div>
                        <div class="player-info">
                            <div><strong>${player.name}</strong></div>
                            <div class="player-fame">ëª…ì„±: ${player.fame} | ë¼ìš´ë“œ ì ìˆ˜: ${roundScore}</div>
                        </div>
                        <div class="player-tier ${tier.class}">${tier.name}</div>
                        <div style="font-size: 1.5em; font-weight: bold;">${player.totalScore}</div>
                    </div>
                `;
            }).join('');
        }

        function nextRound() {
            gameState.currentRound++;
            gameState.currentPlayerIndex = 0;

            if (gameState.currentRound > gameState.totalRounds) {
                showVictoryScreen();
            } else {
                startRound();
            }
        }

        // ==================== ë³´ìŠ¤ì „ ====================

        function showBossIntro(boss) {
            gameState.currentBoss = boss;
            gameState.bossActive = true;

            showScreen('boss-screen');

            document.getElementById('boss-portrait').textContent = boss.icon;
            document.getElementById('boss-name').textContent = boss.name;
            document.getElementById('boss-title').textContent = boss.title;
            document.getElementById('boss-description').textContent = boss.description;
            document.getElementById('boss-skill-name').textContent = boss.skillName;
            document.getElementById('boss-skill-desc').textContent = boss.skillDesc;
        }

        function startBossBattle() {
            showScreen('game-screen');
            updatePhaseIndicator();
            showIngredientPhase();
        }

        // ==================== ìŠ¹ë¦¬ í™”ë©´ ====================

        function showVictoryScreen() {
            showScreen('victory-screen');

            const sortedPlayers = [...gameState.players].sort((a, b) => b.totalScore - a.totalScore);
            const winner = sortedPlayers[0];

            document.getElementById('winner-name').textContent = winner.name;

            const standings = document.getElementById('final-standings');
            standings.innerHTML = sortedPlayers.map((player, index) => {
                const tier = TIERS.filter(t => player.fame >= t.fame).pop();
                const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', ''];

                return `
                    <div class="scoreboard-row ${index === 0 ? 'current' : ''}">
                        <div class="player-rank">${medals[index] || (index + 1)}</div>
                        <div class="player-info">
                            <div><strong>${player.name}</strong></div>
                            <div class="player-fame">ëª…ì„±: ${player.fame}</div>
                        </div>
                        <div class="player-tier ${tier.class}">${tier.name}</div>
                        <div style="font-size: 1.5em; font-weight: bold;">${player.totalScore}</div>
                    </div>
                `;
            }).join('');
        }

        // ==================== íƒ€ì´ë¨¸ ====================

        function startTimer(seconds, callback) {
            gameState.timeRemaining = seconds;
            updateTimerDisplay();

            gameState.timerInterval = setInterval(() => {
                gameState.timeRemaining--;
                updateTimerDisplay();

                if (gameState.timeRemaining <= 0) {
                    stopTimer();
                    callback();
                }
            }, 1000);
        }

        function stopTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = gameState.timeRemaining;

            if (gameState.timeRemaining <= 10) {
                timerEl.style.color = '#ff6b6b';
                timerEl.classList.add('pulse');
            } else {
                timerEl.style.color = '#ffd700';
                timerEl.classList.remove('pulse');
            }
        }

        // ==================== ì´ˆê¸°í™” ====================

        document.addEventListener('DOMContentLoaded', () => {
            setPlayerCount(2);
            document.querySelector('.player-count-btn').classList.add('selected');
        });
    </script>
</body>
</html>
