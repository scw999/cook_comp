<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고메 워즈: 미식의 계단</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <!-- 메인 메뉴 -->
        <div id="main-menu" class="screen active">
            <div class="main-title">
                <h1>고메 워즈</h1>
                <h2>미식의 계단</h2>
                <p class="subtitle">Spring Boot + Java Edition</p>
            </div>
            <div class="menu-buttons">
                <button class="btn btn-primary" onclick="showScreen('player-setup')">새 게임</button>
                <button class="btn btn-secondary" onclick="showScreen('how-to-play')">게임 방법</button>
            </div>
        </div>

        <!-- 게임 방법 -->
        <div id="how-to-play" class="screen">
            <h2 class="section-title">게임 방법</h2>
            <div class="help-content">
                <h3>게임 개요</h3>
                <p>다른 플레이어들과 요리 대결을 펼쳐 최고의 미식 마스터가 되세요!</p>

                <h3>라운드당 3단계 진행</h3>
                <p><strong>1. 재료 수집:</strong> 제한 시간 내에 재료를 선택하세요. 시너지 보너스를 노리세요!</p>
                <p><strong>2. 조리하기:</strong> 스페이스바를 눌러 정확한 타이밍에 조리하세요.</p>
                <p><strong>3. 플레이팅:</strong> 테마를 선택하고 접시를 장식하여 추가 점수를 얻으세요.</p>

                <h3>점수 계산</h3>
                <p>두 명의 심사위원이 당신의 요리를 평가합니다:</p>
                <p><strong>심사위원 A (냉철한 분석가):</strong> 조리 기술과 재료 궁합에 집중</p>
                <p><strong>심사위원 B (감성 미식가):</strong> 플레이팅, 테마, 프레젠테이션을 중시</p>

                <h3>보스전</h3>
                <p>세 명의 전설적인 셰프를 물리치고 미식 마스터의 칭호를 획득하세요!</p>
            </div>
            <div class="center-buttons">
                <button class="btn btn-secondary" onclick="showScreen('main-menu')">돌아가기</button>
            </div>
        </div>

        <!-- 플레이어 설정 -->
        <div id="player-setup" class="screen">
            <div class="player-setup">
                <h2 class="section-title">플레이어 선택</h2>
                <div class="player-count-selector">
                    <button class="player-count-btn" onclick="setPlayerCount(2)">2</button>
                    <button class="player-count-btn" onclick="setPlayerCount(3)">3</button>
                    <button class="player-count-btn" onclick="setPlayerCount(4)">4</button>
                </div>
                <div id="player-names" class="player-names"></div>
                <button class="btn btn-primary" onclick="startGame()">게임 시작</button>
                <button class="btn btn-secondary" onclick="showScreen('main-menu')">돌아가기</button>
            </div>
        </div>

        <!-- 게임 화면 -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="round-info">라운드 <span id="current-round">1</span> / <span id="total-rounds">4</span></div>
                <div class="current-player" id="current-player-display">플레이어 1의 차례</div>
                <div class="timer" id="timer">60</div>
            </div>

            <div class="phase-indicator">
                <div class="phase" id="phase-1">1. 재료 수집</div>
                <div class="phase" id="phase-2">2. 조리하기</div>
                <div class="phase" id="phase-3">3. 플레이팅</div>
            </div>

            <!-- 1단계: 재료 선택 -->
            <div id="ingredient-phase" class="game-phase">
                <h3 class="phase-title">재료를 선택하세요</h3>
                <p class="phase-subtitle">주재료 1개와 부재료 2개를 선택하세요</p>

                <div class="selected-ingredients">
                    <div class="selected-slot" id="main-slot">
                        <span class="slot-icon">?</span>
                        <span class="slot-label">주재료</span>
                    </div>
                    <div class="selected-slot" id="sub-slot-1">
                        <span class="slot-icon">?</span>
                        <span class="slot-label">부재료 1</span>
                    </div>
                    <div class="selected-slot" id="sub-slot-2">
                        <span class="slot-icon">?</span>
                        <span class="slot-label">부재료 2</span>
                    </div>
                </div>

                <div class="synergy-display">
                    <div>현재 시너지</div>
                    <div class="synergy-score synergy-neutral" id="synergy-score">0</div>
                    <div id="synergy-message" class="synergy-message"></div>
                </div>

                <div class="category-tabs" id="category-tabs">
                    <th:block th:each="entry : ${categoryNames}">
                        <button class="category-tab" th:data-category="${entry.key}"
                                th:text="${entry.value}" onclick="renderIngredients(this.dataset.category)"></button>
                    </th:block>
                </div>
                <div class="ingredient-grid" id="ingredient-grid"></div>

                <div class="center-buttons">
                    <button class="btn btn-primary" id="confirm-ingredients" onclick="confirmIngredients()" disabled>선택 완료</button>
                </div>
            </div>

            <!-- 2단계: 조리 -->
            <div id="cooking-phase" class="game-phase" style="display: none;">
                <div class="cooking-game">
                    <h3>조리 시간!</h3>
                    <div class="cooking-animation" id="cooking-emoji">🍳</div>
                    <div class="cooking-instructions">초록색 영역에서 스페이스바를 누르세요!</div>

                    <div class="gauge-container">
                        <div class="gauge-target" id="gauge-target"></div>
                        <div class="gauge-indicator" id="gauge-indicator"></div>
                    </div>

                    <div class="cooking-score">점수: <span id="cooking-score">0</span></div>
                    <div class="combo-display">콤보: <span id="combo-count">0</span>x</div>
                    <div class="attempts-display">
                        <span id="cooking-attempts">시도: 0/5</span>
                    </div>
                </div>
            </div>

            <!-- 3단계: 플레이팅 -->
            <div id="plating-phase" class="game-phase" style="display: none;">
                <h3 class="phase-title">플레이팅 & 프레젠테이션</h3>

                <div class="plating-area">
                    <div class="plate-canvas" id="plate-canvas">
                        <span class="plate-placeholder">당신의 요리</span>
                    </div>

                    <div class="theme-selector">
                        <h4>테마 선택</h4>
                        <div id="theme-options">
                            <th:block th:each="theme : ${themes}">
                                <div class="theme-option" th:data-id="${theme.id}" onclick="selectTheme(this.dataset.id)">
                                    <span class="theme-icon" th:text="${theme.icon}"></span>
                                    <span class="theme-name" th:text="${theme.name}"></span>
                                </div>
                            </th:block>
                        </div>

                        <h4>장식</h4>
                        <div class="decoration-palette" id="decoration-palette">
                            <th:block th:each="dec : ${decorations}">
                                <div class="decoration-item" th:data-emoji="${dec}"
                                     th:text="${dec}" onclick="addDecoration(this.dataset.emoji)"></div>
                            </th:block>
                        </div>
                    </div>
                </div>

                <div class="center-buttons">
                    <button class="btn btn-primary" onclick="confirmPlating()">요리 완성</button>
                </div>
            </div>
        </div>

        <!-- 심사 화면 -->
        <div id="judging-screen" class="screen">
            <div class="judging-screen">
                <h2 class="section-title">심사 시간!</h2>
                <div id="dish-presentation">
                    <span class="final-dish-emoji" id="final-dish-emoji">🍽️</span>
                </div>

                <div class="judges-panel">
                    <div class="judge-card">
                        <div class="judge-avatar">🧐</div>
                        <div class="judge-name">심사위원 A</div>
                        <div class="judge-type">냉철한 분석가</div>
                        <div class="judge-score" id="judge-a-score">--</div>
                        <div class="score-breakdown" id="judge-a-breakdown"></div>
                    </div>

                    <div class="judge-card">
                        <div class="judge-avatar">😋</div>
                        <div class="judge-name">심사위원 B</div>
                        <div class="judge-type">감성 미식가</div>
                        <div class="judge-score" id="judge-b-score">--</div>
                        <div class="score-breakdown" id="judge-b-breakdown"></div>
                    </div>
                </div>

                <div class="final-score">총점: <span id="total-score">--</span></div>

                <button class="btn btn-primary" onclick="nextTurn()">다음</button>
            </div>
        </div>

        <!-- 보스전 화면 -->
        <div id="boss-screen" class="screen">
            <div class="boss-intro">
                <h2 class="boss-alert">보스전!</h2>
                <div class="boss-portrait" id="boss-portrait">👨‍🍳</div>
                <div class="boss-name" id="boss-name">보스 이름</div>
                <div class="boss-title" id="boss-title">보스 칭호</div>
                <p class="boss-description" id="boss-description"></p>
                <div class="boss-skill">
                    <h4>보스 스킬: <span id="boss-skill-name"></span></h4>
                    <p id="boss-skill-desc"></p>
                </div>
                <button class="btn btn-primary" onclick="startBossBattle()">도전!</button>
            </div>
        </div>

        <!-- 라운드 결과 화면 -->
        <div id="round-results" class="screen">
            <h2 class="section-title">라운드 결과</h2>
            <div class="scoreboard" id="round-scoreboard"></div>
            <div class="center-buttons">
                <button class="btn btn-primary" onclick="nextRound()">다음 라운드</button>
            </div>
        </div>

        <!-- 승리 화면 -->
        <div id="victory-screen" class="screen">
            <div class="victory-screen">
                <div class="trophy">🏆</div>
                <h2 class="victory-title">우승!</h2>
                <div class="winner-name" id="winner-name">플레이어 1</div>
                <p class="winner-subtitle">님이 새로운 미식 마스터입니다!</p>
                <div id="final-standings" class="scoreboard"></div>
                <button class="btn btn-primary" onclick="location.reload()">다시 하기</button>
            </div>
        </div>
    </div>

    <!-- 이벤트 팝업 -->
    <div id="event-overlay" class="overlay" style="display: none;"></div>
    <div id="event-popup" class="event-popup" style="display: none;">
        <div class="event-icon" id="event-icon">⚡</div>
        <div class="event-title" id="event-title">돌발 이벤트!</div>
        <p id="event-description">예상치 못한 일이 발생했습니다!</p>
        <button class="btn btn-secondary" onclick="closeEvent()">계속하기</button>
    </div>

    <!-- 서버에서 전달받은 데이터를 JavaScript에서 사용 -->
    <script th:inline="javascript">
        const SERVER_INGREDIENTS = /*[[${ingredients}]]*/ {};
        const CATEGORY_NAMES = /*[[${categoryNames}]]*/ {};
        const SERVER_THEMES = /*[[${themes}]]*/ [];
        const SERVER_DECORATIONS = /*[[${decorations}]]*/ [];
        const SERVER_BOSSES = /*[[${bosses}]]*/ [];
    </script>
    <script th:src="@{/js/game.js}"></script>
</body>
</html>
